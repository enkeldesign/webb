<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess.com Game Fetcher</title>

    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f7fa;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 800px;
        margin: 40px auto;
        background-color: #ffffff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        margin-bottom: 10px;
    }

    .subtitle {
        text-align: center;
        color: #777;
        margin-bottom: 30px;
    }

    .form-control {
        margin-bottom: 15px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }

    input[type="text"],
    input[type="month"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1rem;
    }

    button {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background-color: #0056b3;
    }

    #status {
        margin-top: 20px;
        padding: 10px;
        border-radius: 4px;
    }

    #status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    #status.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .hidden {
        display: none;
    }

    #results {
        margin-top: 30px;
    }

    .game {
        border-bottom: 1px solid #eee;
        padding: 15px 0;
    }

    .game:last-child {
        border-bottom: none;
    }

    .game-header {
        font-size: 1.1rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .game-details {
        margin-bottom: 10px;
        font-size: 0.95rem;
        color: #555;
    }

    .game-details span {
        display: inline-block;
        margin-right: 15px;
    }

    .game-link a {
        color: #007bff;
        text-decoration: none;
    }

    .game-link a:hover {
        text-decoration: underline;
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chess.com Game Fetcher</h1>
        <p class="subtitle">Enter a Chess.com username and select a month to fetch that player's games.</p>
        <form id="game-form">
            <div class="form-control">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" placeholder="e.g. MagnusCarlsen" required>
            </div>
            <div class="form-control">
                <label for="month">Month:</label>
                <!-- The month input lets users choose both year and month in one control -->
                <input type="month" id="month" name="month" required>
            </div>
            <button type="submit" id="submit-btn">Fetch Games</button>
        </form>
        <div id="status" role="alert" class="hidden"></div>
        <div id="results"></div>
    </div>

    <script>
    // script.js for Chess.com Game Fetcher

    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('game-form');
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');

        function showStatus(message, type = 'success') {
            statusDiv.textContent = message;
            statusDiv.className = '';
            statusDiv.classList.add(type);
            statusDiv.classList.remove('hidden');
        }

        function clearStatus() {
            statusDiv.textContent = '';
            statusDiv.className = '';
            statusDiv.classList.add('hidden');
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            clearResults();
            clearStatus();
            const usernameInput = document.getElementById('username');
            const monthInput = document.getElementById('month');

            const username = usernameInput.value.trim();
            const monthValue = monthInput.value; // format: YYYY-MM

            if (!username || !monthValue) {
                showStatus('Please provide both a username and a month.', 'error');
                return;
            }

            // Extract year and month
            const [year, month] = monthValue.split('-');
            const monthFormatted = month.startsWith('0') ? month.slice(1) : month;

            const apiUrl = `https://api.chess.com/pub/player/${encodeURIComponent(username)}/games/${year}/${monthFormatted}`;

            showStatus('Fetching games...', 'success');

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(\`Unable to fetch games. (HTTP \${response.status})\`);
                }
                const data = await response.json();
                const games = data.games || [];

                if (games.length === 0) {
                    showStatus('No games found for the specified month.', 'error');
                    return;
                }

                clearStatus();
                renderGames(games, username);
            } catch (err) {
                console.error(err);
                showStatus(\`Error: \${err.message}\`, 'error');
            }
        });

        function renderGames(games, username) {
            const fragment = document.createDocumentFragment();

            games.forEach((game) => {
                // Determine if the user played as white or black
                const isWhite = game.white && game.white.username.toLowerCase() === username.toLowerCase();
                const userData = isWhite ? game.white : game.black;
                const opponentData = isWhite ? game.black : game.white;

                const gameDiv = document.createElement('div');
                gameDiv.className = 'game';

                const header = document.createElement('div');
                header.className = 'game-header';
                header.textContent = \`\${userData.username} vs. \${opponentData.username}\`;

                const details = document.createElement('div');
                details.className = 'game-details';

                const dateSpan = document.createElement('span');
                const date = new Date(game.end_time * 1000);
                dateSpan.textContent = date.toLocaleString();

                const resultSpan = document.createElement('span');
                resultSpan.textContent = \`Result: \${userData.result}\`;

                const timeControlSpan = document.createElement('span');
                timeControlSpan.textContent = \`Time Control: \${game.time_control}\`;

                const ratedSpan = document.createElement('span');
                ratedSpan.textContent = \`Rated: \${game.rated ? 'Yes' : 'No'}\`;

                [dateSpan, resultSpan, timeControlSpan, ratedSpan].forEach((span) => {
                    details.appendChild(span);
                });

                const linkDiv = document.createElement('div');
                linkDiv.className = 'game-link';
                const gameLink = document.createElement('a');
                gameLink.href = game.url || '#';
                gameLink.target = '_blank';
                gameLink.rel = 'noopener noreferrer';
                gameLink.textContent = 'View Game on Chess.com';
                linkDiv.appendChild(gameLink);

                gameDiv.appendChild(header);
                gameDiv.appendChild(details);
                gameDiv.appendChild(linkDiv);

                fragment.appendChild(gameDiv);
            });

            resultsDiv.appendChild(fragment);
        }
    });
    </script>
</body>
</html>