<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Movie Marathon - Rate & Predict</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 400px; 
            margin: 0 auto; 
            padding: 15px; 
            background: linear-gradient(135deg, #111 0%, #1a1a2e 50%, #16213e 100%); 
            color: #fff; 
            min-height: 100vh;
        }
        h1 { 
            text-align: center; 
            color: #ff4444; 
            margin-bottom: 10px; 
            font-size: 1.8em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .movie-grid { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .movie { 
            background: rgba(34,34,34,0.9); 
            border-radius: 15px; 
            padding: 20px; 
            box-shadow: 0 8px 32px rgba(255,68,68,0.2); 
            border: 1px solid rgba(255,68,68,0.1);
            backdrop-filter: blur(10px);
        }
        .movie h2 { 
            margin: 0 0 12px; 
            color: #ff6666; 
            font-size: 1.2em;
            font-weight: 600;
        }
        .poster-placeholder {
            width: 100%; 
            height: 220px; 
            background: linear-gradient(135deg, #ff4444 0%, #ff6666 50%, #ff8888 100%);
            border-radius: 10px; 
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: rgba(255,255,255,0.9);
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }
              .poster-placeholder.blue {
                            background: linear-gradient(135deg, #4444ff 0%, #6666ff 50%, #8888ff 100%);}

                      .poster-placeholder.space {
                            background: linear-gradient(135deg, #222233 0%, #333344 50%, #444455 100%);}
              .poster-placeholder.brown {
                            background: linear-gradient(135deg, #664422 0%, #775533 50%, #886644 100%);}

        
        
        .poster-placeholder::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: shimmer 3s infinite linear;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }
        .synopsis { 
            line-height: 1.4; 
            margin: 12px 0; 
            font-size: 0.9em;
            color: #ddd;
        }
        .rating-section { margin: 15px 0; }
        .stars-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 28px;
            cursor: pointer;
            filter: grayscale(100%) opacity(0.4);
            transition: all 0.3s ease;
            padding: 5px 0;
        }
        .stars-container.rated {
            filter: none;
            opacity: 1;
        }
        .star {
            flex: 1;
            text-align: center;
            transition: all 0.2s;
            padding: 4px;
        }
        .star.filled { 
            color: #ffd700 !important; 
            text-shadow: 0 0 12px #ffd700;
            filter: none !important;
        }
        .avg-rating { 
            font-weight: 600; 
            color: #ff6666; 
            margin-top: 8px; 
            font-size: 0.9em;
        }
        .predicted { 
            background: rgba(76,175,80,0.3); 
            padding: 12px; 
            border-radius: 8px; 
            margin-top: 10px; 
            color: #4CAF50; 
            font-weight: 700;
            border: 1px solid rgba(76,175,80,0.5);
            text-align: center;
        }
        .section-divider { 
            text-align: center; 
            margin: 30px 0; 
            font-size: 1.4em; 
            color: #ff6666;
            font-weight: 600;
        }
        .subtitle {
            text-align: center;
            margin-bottom: 20px;
            color: #ffaa00;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <h1>üåã Disaster Marathon</h1>
    
    <div class="subtitle">‚≠ê Rate Movies You've Seen</div>
    <p style="text-align: center; color: #ccc; font-size: 0.9em;">Click stars (1-5) to rate. Predictions update instantly!</p>
    
    <div class="movie-grid" id="rated-movies">
        <div class="movie" data-tags="earthquake,tsunami,flood">
            <h2>2012 (2009)</h2>
            <div class="poster-placeholder">üåçüí•</div>
            <p class="synopsis">Global cataclysms trigger massive earthquakes, tsunamis, and volcanic eruptions as one family races for arks.</p>
            <div class="rating-section">
                <div class="stars-container" data-movie="2012">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
                <div class="avg-rating" id="avg-2012">-</div>
            </div>
        </div>
        
        <div class="movie" data-tags="weather,ice,freeze">
            <h2>The Day After Tomorrow (2004)</h2>
            <div class="poster-placeholder blue">‚ùÑÔ∏èüå™Ô∏è</div>
            <p class="synopsis">Abrupt climate change unleashes superstorms, plunging Earth into a new Ice Age as a father saves his son.</p>
            <div class="rating-section">
                <div class="stars-container" data-movie="day-after">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
                <div class="avg-rating" id="avg-day-after">-</div>
            </div>
        </div>
        
        <div class="movie" data-tags="space,asteroid">
            <h2>Armageddon (1998)</h2>
            <div class="poster-placeholder space">‚òÑÔ∏èüöÄ</div>
            <p class="synopsis">Oil drillers become astronauts racing to nuke a Texas-sized asteroid hurtling toward Earth.</p>
            <div class="rating-section">
                <div class="stars-container" data-movie="armageddon">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
                <div class="avg-rating" id="avg-armageddon">-</div>
            </div>
        </div>
        
        <div class="movie" data-tags="space,comet,tsunami">
            <h2>Deep Impact (1998)</h2>
            <div class="poster-placeholder space">‚òÑÔ∏èüåä</div>
            <p class="synopsis">A comet threatens Earth; journalists and astronauts scramble while tsunamis devastate coasts.</p>
            <div class="rating-section">
                <div class="stars-container" data-movie="deep-impact">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
                <div class="avg-rating" id="avg-deep-impact">-</div>
            </div>
        </div>
        
        <div class="movie" data-tags="alien,invasion">
            <h2>Independence Day (1996)</h2>
            <div class="poster-placeholder space">üëΩüí•</div>
            <p class="synopsis">Alien saucers attack Earth cities; humanity unites for a desperate counterstrike.</p>
            <div class="rating-section">
                <div class="stars-container" data-movie="independence-day">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
                <div class="avg-rating" id="avg-independence">-</div>
            </div>
        </div>
    </div>
    
    <div class="section-divider">‚û§ PREDICTED RATINGS ‚û§</div>
    
    <div class="subtitle" style="color: #4CAF50;">üéØ Predicted Ratings (Unseen Movies)</div>
    <div class="movie-grid" id="predicted-movies">
        <div class="movie" data-tags="volcano,lava">
            <h2>Volcano (1997)</h2>
            <div class="poster-placeholder">üåãüî•</div>
            <p class="synopsis">Lava erupts beneath Los Angeles, flowing through streets as teams race to contain it.</p>
            <div class="predicted" id="pred-volcano">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        
        <div class="movie" data-tags="volcano,ash">
            <h2>Dante's Peak (1997)</h2>
            <div class="poster-placeholder">
              üåãüî•
          </div>
            <p class="synopsis">Volcanologist evacuates town as Mount Dante erupts with pyroclastic flows and ash.</p>
            <div class="predicted" id="pred-dantes">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        
        <div class="movie" data-tags="earthquake,tsunami">
            <h2>San Andreas (2015)</h2>
            <div class="poster-placeholder brown">üåçüåä</div>
            <p class="synopsis">Massive earthquake ravages California as pilot searches family amid tsunamis.</p>
            <div class="predicted" id="pred-san-andreas">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        
        <div class="movie" data-tags="space,moon,alien">
            <h2>Moonfall (2022)</h2>
            <div class="poster-placeholder space">üåçüåí</div>
            <p class="synopsis">Moon destabilizes toward Earth; NASA uncovers secrets to prevent annihilation.</p>
            <div class="predicted" id="pred-moonfall">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        
        <div class="movie" data-tags="weather,tornado">
            <h2>Twister (1996)</h2>
            <div class="poster-placeholder blue">üå™Ô∏è‚ö°</div>
            <p class="synopsis">Storm chasers pursue F5 tornado with innovative tech amid roaring winds.</p>
            <div class="predicted" id="pred-twister">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
        
        <div class="movie" data-tags="earth,core">
            <h2>The Core (2003)</h2>
            <div class="poster-placeholder brown">üåéüî•</div>
            <p class="synopsis">Earth's core stops; team drills center to detonate nukes and restart it.</p>
            <div class="predicted" id="pred-core">Predicted: ‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>
    </div>

<script>
  const movieTags = {
    '2012': ['earthquake','tsunami','flood'],
    'day-after': ['weather','ice','freeze'],
    'armageddon': ['space','asteroid'],
    'deep-impact': ['space','comet','tsunami'],
    'independence-day': ['alien','invasion'],
    'volcano': ['volcano','lava'],
    'dantes': ['volcano','ash'],
    'san-andreas': ['earthquake','tsunami'],
    'moonfall': ['space','moon','alien'],
    'twister': ['weather','tornado'],
    'core': ['earth','core']
  };

  const predictedMovieIds = ['volcano', 'dantes', 'san-andreas', 'moonfall', 'twister', 'core'];

  const ratings = {};
  let mouseDown = false;

  document.addEventListener('mousedown', () => mouseDown = true);
  document.addEventListener('mouseup', () => mouseDown = false);

  // --- Helpers to show/hide predictions until there is at least one rating ---
  function setPredictionsVisibility(hasRatings) {
    const divider = document.querySelector('.section-divider');
    const subtitle = document.querySelector('#predicted-movies')?.previousElementSibling; // the green subtitle
    const predictedGrid = document.getElementById('predicted-movies');

    // If markup changes later, fail gracefully:
    if (divider) divider.style.display = hasRatings ? '' : 'none';
    if (subtitle && subtitle.classList.contains('subtitle')) subtitle.style.display = hasRatings ? '' : 'none';
    if (predictedGrid) predictedGrid.style.display = hasRatings ? '' : 'none';
  }

  function resetPredictionsUI() {
    predictedMovieIds.forEach(movieId => {
      const el = getPredictionEl(movieId);
      if (el) el.textContent = 'Predicted: -';
    });
  }

  function getPredictionEl(movieId) {
    // Your IDs are: pred-volcano, pred-dantes, pred-san-andreas, pred-moonfall, pred-twister, pred-core
    return document.getElementById(`pred-${movieId}`);
  }

  // --- Star click rating logic ---
  document.querySelectorAll('.stars-container').forEach(container => {
    const movieId = container.dataset.movie;

    container.addEventListener('click', (e) => {
      const rect = container.getBoundingClientRect();
      const pos = e.clientX - rect.left;
      const starIndex = Math.min(4, Math.floor(pos / (rect.width / 5)));
      const rating = starIndex + 1;
      setRating(movieId, rating);
    });

    container.addEventListener('mouseenter', () => {
      if (!container.classList.contains('rated')) {
        container.style.filter = 'grayscale(50%) opacity(0.7)';
      }
    });

    container.addEventListener('mouseleave', () => {
      if (!container.classList.contains('rated')) {
        container.style.filter = 'grayscale(100%) opacity(0.4)';
      }
    });
  });

  function setRating(movieId, rating) {
    ratings[movieId] = rating;
    updateStarsVisual(movieId, rating);
    updateRatingDisplay(movieId, rating);
    updatePredictions();
    localStorage.setItem('disasterRatings', JSON.stringify(ratings));
  }

  function updateStarsVisual(movieId, rating) {
    const container = document.querySelector(`[data-movie="${movieId}"]`);
    container.classList.add('rated');
    const stars = container.querySelectorAll('.star');
    stars.forEach((star, i) => {
      star.classList.toggle('filled', i < rating);
    });
  }

  function updateRatingDisplay(movieId, rating) {
    const avgEl = document.getElementById(`avg-${movieId}`);
    // Note: your avg IDs are avg-2012, avg-day-after, avg-armageddon, avg-deep-impact, avg-independence
    // but movieId for independence is "independence-day" -> mismatch in your HTML.
    // We handle it safely:
    if (!avgEl) return;
    avgEl.textContent = `Your rating: ${'‚≠ê'.repeat(rating)}`;
  }

  // --- Prediction algorithm (tweaked down) ---
  function updatePredictions() {
    const ratedMovies = Object.keys(ratings);
    const hasRatings = ratedMovies.length > 0;

    setPredictionsVisibility(hasRatings);

    if (!hasRatings) {
      resetPredictionsUI();
      return;
    }

    // Build tag -> [ratings] map
    const tagPreferences = {};
    ratedMovies.forEach(movieId => {
      const tags = movieTags[movieId] || [];
      tags.forEach(tag => {
        (tagPreferences[tag] ||= []).push(ratings[movieId]);
      });
    });

    // Tag averages
    const tagAverages = {};
    Object.keys(tagPreferences).forEach(tag => {
      const arr = tagPreferences[tag];
      tagAverages[tag] = arr.reduce((a, b) => a + b, 0) / arr.length;
    });

    // Overall average
    const overallAvg = ratedMovies.reduce((sum, id) => sum + ratings[id], 0) / ratedMovies.length;

    predictedMovieIds.forEach(movieId => {
      // Don‚Äôt show predictions for movies you‚Äôve explicitly rated (future-proofing)
      if (ratings[movieId]) return;

      const tags = movieTags[movieId] || [];

      // Key tweaks vs your old code:
      // - Remove the +0.5 optimistic boost
      // - Use a slightly conservative baseline (3.0 instead of 3.5)
      // - Give overall average a bit more weight (stabilizes, reduces tag spikes)
      // - Apply a small downward bias (-0.2) to avoid ceiling effects
      let tagScoreSum = 0;
      let tagWeightSum = 0;

      tags.forEach(tag => {
const avg = (tagAverages[tag] ?? 3.1);
        const w = 0.7; // was 0.75 (tags dominated too hard)
        tagScoreSum += avg * w;
        tagWeightSum += w;
      });

      const tagComponent = tagWeightSum ? (tagScoreSum / tagWeightSum) : 3.0;

      // Blend tag preference with your overall taste
const predictedRaw = (tagComponent * 0.55) + (overallAvg * 0.45) - 0.05;

      const predicted = Math.max(1, Math.min(5, predictedRaw));

      // Convert to stars:
      // Using round (not ceil) massively reduces ‚Äúalways 5 stars‚Äù.
      const stars = Math.max(1, Math.min(5, Math.round(predicted)));

      const predEl = getPredictionEl(movieId);
      if (predEl) {
        // Remove numeric "(x.x/5)" entirely:
        predEl.textContent = `Predicted: ${'‚≠ê'.repeat(stars)}`;
      }
    });
  }

  // --- Restore saved ratings ---
  const saved = localStorage.getItem('disasterRatings');
  if (saved) {
    Object.assign(ratings, JSON.parse(saved));
    Object.keys(ratings).forEach(movieId => {
      updateStarsVisual(movieId, ratings[movieId]);
      updateRatingDisplay(movieId, ratings[movieId]);
    });
  }

  // Ensure correct initial state (no ratings => hide predictions + no stats)
  updatePredictions();
</script>
</body>
</html>


